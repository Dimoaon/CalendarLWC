<template>
    <div class="calendar__header">

        <!-- ================= NAVIGATION ================= -->
        <div class="calendar__nav">

            <!-- PREV -->
            <button
                class="calendar__nav-btn calendar__nav-btn--rotate"
                onclick={handlePrev}>
                <c-icon
                    name="arrow"
                    class="calendar__month-switcher">
                </c-icon>
            </button>

            <!-- TITLE + PICKER -->
            <div class="calendar__title-wrapper">

                <button
                    class="calendar__title"
                    onclick={toggleDatePicker}>
                    {monthLabel}
                </button>

                <!-- DATE PICKER -->
                <template if:true={showDatePicker}>
                    <div class="calendar__date-picker">

                        <!-- PICKER HEADER -->
                        <div class="calendar__picker-header">
                            <span class="calendar__picker-year">
                                {baseYear}
                            </span>

                            <button
                                class={yearArrowClass}
                                onclick={toggleYearPicker}>
                                <c-icon name="arrow"></c-icon>
                            </button>
                        </div>

                        <!-- MONTH MODE -->
                        <template if:true={isMonthMode}>
                            <div class="month-grid">
                                <template for:each={months} for:item="m">
                                    <button
                                        key={m.index}
                                        class="month-btn"
                                        data-month={m.index}
                                        onclick={selectMonth}>
                                        {m.label}
                                    </button>
                                </template>
                            </div>
                        </template>

                        <!-- YEAR MODE -->
                        <template if:true={isYearMode}>
                            <div class="year-list">
                                <template for:each={years} for:item="y">
                                    <div
                                        key={y}
                                        class="year-item"
                                        data-year={y}
                                        onclick={selectYear}>
                                        {y}
                                    </div>
                                </template>
                            </div>
                        </template>

                    </div>
                </template>

            </div>

            <!-- NEXT -->
            <button
                class="calendar__nav-btn"
                onclick={handleNext}>
                <c-icon
                    name="arrow"
                    class="calendar__month-switcher">
                </c-icon>
            </button>

        </div>

        <!-- ================= ACTIONS ================= -->
        <div class="calendar__actions">

            <!-- ADD EVENT -->
            <button
                class="calendar__add"
                onclick={toggleQuickAdd}>
                <span class="calendar__text">Add event</span>
                <c-icon
                    name="plus"
                    class="calendar__plus-icon">
                </c-icon>
            </button>

            <!-- QUICK ADD POPUP -->
            <template if:true={isQuickAddOpen}>
                <div class="quick-popup">

                    <div class="quick-popup__arrow"></div>

                    <div class="quick-popup__input-wrapper">
                        <button
                            class="quick-popup__close"
                            onclick={closeQuickAdd}>
                            <c-icon name="close"></c-icon>
                        </button>

                        <input
                            class="quick-popup__input"
                            value={quickAddTitle}
                            placeholder="New Event"
                            oninput={handleQuickInput}
                        />
                    </div>

                    <button
                        class="quick-popup__add"
                        onclick={saveQuickEvent}>
                        Add event
                    </button>

                </div>
            </template>

            <!-- SEARCH -->
            <div class="calendar__search-wrapper">

                <c-icon
                    name="search"
                    class="calendar__search-icon">
                </c-icon>

                <input
                    class="calendar__search"
                    value={searchValue}
                    placeholder="Search"
                    oninput={handleSearchInputLocal}
                />

                <!-- CLEAR SEARCH -->
                <template if:true={hasSearchValue}>
                    <button
                        class="calendar__search-clear"
                        onclick={clearSearch}>
                        <c-icon name="close"></c-icon>
                    </button>
                </template>

            </div>

            <!-- SEARCH RESULTS -->
            <template if:true={hasSearchResults}>
                <div class="calendar__search-results">
                    <template for:each={searchResults} for:item="ev">
                        <div
                            key={ev.id}
                            class="calendar__search-item"
                            data-date={ev.dateKey}
                            onclick={handleResultClick}>
                            <div>{ev.title}</div>
                            <div class="calendar__search-date">
                                {ev.dateKey}
                            </div>
                        </div>
                    </template>
                </div>
            </template>

        </div>

    </div>
</template>
