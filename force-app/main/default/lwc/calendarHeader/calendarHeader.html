<template>
    <div class="calendar__header">

        <div class="calendar__nav">
            <button onclick={handlePrev}
                    class="calendar__nav-btn calendar__nav-btn--rotate">
                <c-icon name="arrow"
                        class="calendar__month-switcher"></c-icon>
            </button>

            <div class="calendar__title-wrapper">

                <button class="calendar__title"
                        onclick={toggleDatePicker}>
                    {monthLabel}
                </button>

                <template if:true={showDatePicker}>
                    <div class="calendar__date-picker">

                        <!-- MONTHS -->
                        <div class="month-grid">
                            <template for:each={months} for:item="m">
                                <button key={m.index}
                                        data-month={m.index}
                                        class="month-btn"
                                        onclick={selectMonth}>
                                    {m.label}
                                </button>
                            </template>
                        </div>

                        <!-- YEARS -->
                        <div class="year-picker">
                            <button onclick={prevYear}>‹</button>

                            <div class="year-list">
                                <template for:each={years} for:item="y">
                                    <div key={y}
                                         data-year={y}
                                         class="year-item"
                                         onclick={selectYear}>
                                        {y}
                                    </div>
                                </template>
                            </div>

                            <button onclick={nextYear}>›</button>
                        </div>

                    </div>
                </template>

            </div>

            <button onclick={handleNext}
                    class="calendar__nav-btn">
                <c-icon name="arrow"
                        class="calendar__month-switcher"></c-icon>
            </button>
        </div>

        <div class="calendar__actions">

            <button class="calendar__add"
                    onclick={handleAdd}>
                <span class="calendar__text">
                    Add event
                </span>
                <c-icon name="plus"
                        class="calendar__plus-icon"></c-icon>
            </button>

            <template if:true={showEventForm}>
                <c-event-form-popup
                    new-event-title={newEventTitle}
                    onclose={handleClose}
                    ontitleinput={handleInput}
                    onsave={handleSave}>
                </c-event-form-popup>
            </template>

            <div class="calendar__search-wrapper">
                <c-icon name="search"
                        class="calendar__search-icon"></c-icon>

                <input
                    class="calendar__search"
                    placeholder="Search"
                    oninput={handleSearchInputLocal}
                />
            </div>

            <template if:true={hasSearchResults}>
                <div class="calendar__search-results">

                    <template for:each={searchResults}
                            for:item="ev">

                        <div key={ev.id}
                            class="calendar__search-item"
                            data-date={ev.dateKey}
                            onclick={handleResultClick}>

                            <div>{ev.title}</div>
                            <div class="calendar__search-date">
                                {ev.dateKey}
                            </div>

                        </div>

                    </template>

                </div>
            </template>

        </div>
    </div>
</template>
